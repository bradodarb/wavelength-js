{"code":"import { __awaiter } from \"tslib\";\r\nclass MiddleWare {\r\n    constructor(terminalFunction) {\r\n        this.complete = terminalFunction;\r\n        this.wares = [];\r\n    }\r\n    use(ware) {\r\n        let wares = [];\r\n        if (Array.isArray(ware)) {\r\n            wares = ware;\r\n        }\r\n        else {\r\n            wares.push(ware);\r\n        }\r\n        wares.forEach((wareFunc) => {\r\n            const previousWare = this.wares[this.wares.length - 1];\r\n            const currentWare = {\r\n                invoke: wareFunc,\r\n                next: null,\r\n            };\r\n            if (previousWare) {\r\n                previousWare.next = currentWare;\r\n            }\r\n            this.wares.push(currentWare);\r\n        });\r\n        return this;\r\n    }\r\n    invoke(state) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.wares.length) {\r\n                this.complete();\r\n                return;\r\n            }\r\n            let ware = this.wares[0];\r\n            while (ware) {\r\n                const error = yield ware.invoke(state);\r\n                if (error) {\r\n                    this.complete(error);\r\n                    return;\r\n                }\r\n                ware = ware.next;\r\n            }\r\n            this.complete();\r\n        });\r\n    }\r\n}\r\nexport { MiddleWare };\r\n//# sourceMappingURL=index.js.map","references":["/home/bradodarb/_git/wavelength/wavelength-js/src/logging/util.ts","/home/bradodarb/_git/wavelength/wavelength-js/src/runtime/handler-state.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"/\",\"sources\":[\"middleware/index.ts\"],\"names\":[],\"mappings\":\";AAkBA,MAAM,UAAU;IAIZ,YAAY,gBAA6C;QACrD,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAAC;QACjC,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;IACpB,CAAC;IAGD,GAAG,CAAC,IAA+B;QAC/B,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACrB,KAAK,GAAG,IAAI,CAAC;SAChB;aAAM;YACH,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACpB;QAED,KAAK,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;YACvB,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACvD,MAAM,WAAW,GAAG;gBAChB,MAAM,EAAE,QAAQ;gBAChB,IAAI,EAAE,IAAI;aACb,CAAC;YACF,IAAI,YAAY,EAAE;gBACd,YAAY,CAAC,IAAI,GAAG,WAAW,CAAC;aACnC;YACD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC;IAChB,CAAC;IAEK,MAAM,CAAC,KAA0B;;YACnC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;gBACpB,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAChB,OAAO;aACV;YAED,IAAI,IAAI,GAA4B,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAClD,OAAO,IAAI,EAAE;gBACT,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBACvC,IAAI,KAAK,EAAE;oBACP,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;oBACrB,OAAO;iBACV;gBACD,IAAI,GAAG,IAAI,CAAC,IAAI,CAAA;aACnB;YACD,IAAI,CAAC,QAAQ,EAAE,CAAC;QACpB,CAAC;KAAA;CACJ;AAED,OAAO,EAAC,UAAU,EAAgE,CAAA\"}","dts":{"name":"/home/bradodarb/_git/wavelength/wavelength-js/middleware/index.d.ts","writeByteOrderMark":false,"text":"import { IHandlerState } from \"@runtime/handler-state\";\r\ninterface IMiddleWareTerminalFunction {\r\n    (error?: Error): void | never;\r\n}\r\ninterface IMiddleWareFunction<E, C> {\r\n    (state: IHandlerState<E, C>): void | Error | Promise<void | Error>;\r\n}\r\ninterface IMiddleWare<E, C> {\r\n    invoke: IMiddleWareFunction<E, C>;\r\n    next: IMiddleWare<E, C> | null;\r\n}\r\ndeclare class MiddleWare<E, C> {\r\n    wares: IMiddleWare<E, C>[];\r\n    complete: IMiddleWareTerminalFunction;\r\n    constructor(terminalFunction: IMiddleWareTerminalFunction);\r\n    use(ware: IMiddleWareFunction<E, C>): MiddleWare<E, C>;\r\n    invoke(state: IHandlerState<E, C>): Promise<void>;\r\n}\r\nexport { MiddleWare, IMiddleWareFunction, IMiddleWare, IMiddleWareTerminalFunction };\r\n"}}
